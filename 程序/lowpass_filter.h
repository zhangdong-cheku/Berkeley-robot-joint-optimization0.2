#include <Arduino.h> 

// ============================================================================
// 头文件保护宏：防止重复包含
// ============================================================================
#ifndef LOWPASS_FILTER_H
#define LOWPASS_FILTER_H

// ============================================================================
// 类定义：LowPassFilter
// 功能：一阶低通滤波器类，用于信号平滑处理
// 说明：实现实时信号滤波，去除高频噪声，保留低频有用信号
// ============================================================================
class LowPassFilter
{
public:
    // ============================================================================
    // 构造函数：LowPassFilter
    // 功能：创建低通滤波器对象并初始化参数
    // 参数：Tf - 低通滤波时间常数（秒），决定滤波强度
    // 说明：时间常数越大，滤波效果越强，响应越慢
    // ============================================================================
    LowPassFilter(float Tf);
    
    // ============================================================================
    // 析构函数：~LowPassFilter
    // 功能：默认析构函数，自动释放资源
    // 说明：使用默认实现，无需特殊清理操作
    // ============================================================================
    ~LowPassFilter() = default;

    // ============================================================================
    // 运算符重载函数：operator()
    // 功能：滤波器的主要处理接口，实现函数对象模式
    // 参数：x - 当前输入信号值
    // 返回值：滤波后的输出信号值
    // 说明：使用括号运算符重载，使滤波器对象可以像函数一样调用
    // ============================================================================
    float operator() (float x);
    
    // ============================================================================
    // 公共成员变量：Tf
    // 类型：float
    // 功能：低通滤波时间常数（秒）
    // 说明：决定滤波器的截止频率，Tf越大滤波效果越强
    // ============================================================================
    float Tf; //!< 低通滤波时间常数

protected:
    // ============================================================================
    // 保护成员变量：timestamp_prev
    // 类型：unsigned long
    // 功能：记录上一次滤波器执行的时间戳（微秒）
    // 说明：用于计算时间间隔，实现自适应滤波系数
    // ============================================================================
    unsigned long timestamp_prev;  //!< 最后执行时间戳
    
    // ============================================================================
    // 保护成员变量：y_prev
    // 类型：float
    // 功能：存储上一次滤波后的输出值
    // 说明：用于递归滤波计算，实现一阶低通滤波算法
    // ============================================================================
    float y_prev; //!< 上一个循环中的过滤后的值
};

// ============================================================================
// 头文件保护宏结束
// ============================================================================
#endif