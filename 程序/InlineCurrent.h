#include <Arduino.h>

// ============================================================================
// 类定义：CurrSense
// 功能：电流传感器类，负责电流信号的采集、处理和校准
// 说明：封装了电流检测的硬件接口和数据处理算法
// ============================================================================
class CurrSense
{
  public:
    // ============================================================================
    // 公共成员函数（接口方法）
    // ============================================================================
    
    // 构造函数：根据电机编号初始化电流传感器
    CurrSense(int Mot_Num);
    
    // ADC电压读取函数：读取指定引脚的ADC电压值
    float readADCVoltageInline(const int pinA);
    
    // ADC配置函数：设置ADC引脚的输入模式
    void configureADCInline(const int pinA,const int pinB, const int pinC);
    
    // 零点校准函数：执行电流传感器的零点偏移校准
    void calibrateOffsets();
    
    // 初始化函数：完整的电流传感器初始化流程
    void init();
    
    // 电流读取函数：获取三相电流测量值
    void getPhaseCurrents();
    
    // ============================================================================
    // 公共成员变量（电流测量数据）
    // ============================================================================
    
    // 三相电流测量值（单位：安培）
    float current_a;  // A相电流值
    float current_b;  // B相电流值
    float current_c;  // C相电流值（在两相检测系统中可能为0）
    
    // ============================================================================
    // 公共成员变量（硬件配置参数）
    // ============================================================================
    
    int pinA;  // A相电流检测ADC引脚编号
    int pinB;  // B相电流检测ADC引脚编号
    int pinC;  // C相电流检测ADC引脚编号（可选）
    
    // ============================================================================
    // 公共成员变量（校准参数）
    // ============================================================================
    
    float offset_ia;  // A相ADC零点偏移电压（伏特）
    float offset_ib;  // B相ADC零点偏移电压（伏特）
    float offset_ic;  // C相ADC零点偏移电压（伏特）
    
    // ============================================================================
    // 公共成员变量（电气参数）
    // ============================================================================
    
    float _shunt_resistor;  // 分流电阻值（欧姆），用于电流检测
    float amp_gain;         // 运算放大器增益倍数
    
    // ============================================================================
    // 公共成员变量（转换系数）
    // ============================================================================
    
    float volts_to_amps_ratio;  // 电压到电流的转换比率
    
    // ============================================================================
    // 公共成员变量（各相增益系数）
    // ============================================================================
    
    float gain_a;  // A相电压到电流的增益系数
    float gain_b;  // B相电压到电流的增益系数
    float gain_c;  // C相电压到电流的增益系数
    
  private:
    // ============================================================================
    // 私有成员变量（内部状态）
    // ============================================================================
    
    int _Mot_Num;  // 电机编号标识（0或1），用于区分不同电机的配置
};